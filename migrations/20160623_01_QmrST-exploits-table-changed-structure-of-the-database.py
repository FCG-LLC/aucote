"""
Exploits table, changed structure of the database
"""

from yoyo import step

__depends__ = {'20160620_01_NRkjR-scans-and-ports-tables'}

steps = [
    step("DELETE FROM vulnerabilities"),
    step('''
        CREATE TABLE exploits (
            id SERIAL,
            app VARCHAR(100) NOT NULL,
            name TEXT NOT NULL,
            title TEXT NOT NULL,
            description TEXT NOT NULL,
            risk_level risk_level_type NOT NULL DEFAULT 'Medium',
            PRIMARY KEY (id),
            UNIQUE(app, name)
            )
    '''), step(''' ALTER TABLE vulnerabilities DROP COLUMN title'''),
    step(''' ALTER TABLE vulnerabilities DROP COLUMN description'''),
    step(''' ALTER TABLE vulnerabilities DROP COLUMN risk_level'''),
    step(''' ALTER TABLE vulnerabilities ADD COLUMN exploit_id INTEGER NOT NULL'''),
    step(''' ALTER TABLE vulnerabilities ADD COLUMN output TEXT NOT NULL'''),
    step(''' ALTER TABLE vulnerabilities ADD CONSTRAINT fk_exploit FOREIGN KEY (exploit_id) REFERENCES exploits(id)''')
]
