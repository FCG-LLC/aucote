from collections import defaultdict
import csv
from os import path
from structs import RiskLevel


class Exploit:
    id = None
    app = None
    name = None
    title = None
    description = None
    risk_level = None

class Exploits:
    '''
    Collection of exploits
    '''
    def __init__(self):
        self._exploits = defaultdict(dict)

    def add(self, exploit):
        self._exploits[exploit.app][exploit.name] = exploit

    def find(self, app, name):
        return self._exploits[app].get(name)

def read_exploits():
    result = Exploits()
    file_name = path.join(path.dirname(path.dirname(__file__)), 'exploits', 'exploits.csv')
    with open(file_name, newline='', encoding='utf-8') as csvfile:
        reader = csv.reader(csvfile, delimiter=';', quotechar='"')
        for num, row in enumerate(reader):
            if num == 0: continue #header
            exploit = Exploit()
            exploit.id = int(row[0])
            exploit.app = row[1]
            exploit.name = row[2]
            exploit.title = row[3]
            exploit.description = row[4]
            exploit.risk_level = RiskLevel(row[5])
            result.add(exploit)
    return result

