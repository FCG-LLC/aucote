from unittest import TestCase
from unittest.mock import MagicMock, patch

from tools.cisco_global_exploiter.tool import CiscoGlobalExploiterTool


class CiscoGlobalExploiterToolTest(TestCase):
    def setUp(self):
        self.config = MagicMock()
        self.executor = MagicMock()
        self.exploits = [MagicMock()]
        self.port = MagicMock()
        self.tool = CiscoGlobalExploiterTool(config=self.config, executor=self.executor, exploits=self.exploits,
                                             port=self.port)

    @patch('tools.cisco_global_exploiter.tool.CiscoGlobalExploiterTask')
    def test_call(self, mock_task):
        self.port.is_ipv6 = False
        self.port.is_broadcast = False
        self.port.is_physical = False
        self.tool()

        mock_task.assert_called_once_with(executor=self.executor, port=self.port, exploits=self.exploits)
        self.executor.add_task.assert_called_once_with(mock_task.return_value)
